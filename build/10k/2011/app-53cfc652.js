/**
 * Sproutable
 */
// Default Variables
function showPage(e,t){pg=e>pages?pages:e;var n=100,r=(pg-1)*limit,s=[];typeof t==u&&(t=400),$("body > .d").animate({opacity:0},200,function(){$(this).remove()});if(mode==1){$("#total").text(pages),$("#page").text(pg),pg==1?$("#prev").hide():$("#prev").unbind("click").click(function(e){e.preventDefault(),showPage(pg-1)}).show(),pg==pages?$("#next").hide():$("#next").unbind("click").click(function(e){e.preventDefault(),showPage(pg+1)}).show();for(i in markers)markers[i].setMap(null);markers=[]}$("#r").length==0&&$('<section id="r" />').insertAfter("#s"),$("#r .g").animate({opacity:0},t),$("#r").animate({height:0},t,function(){if(results.length>0){$("#r").html("");for(i=r;i<r+limit&&i<results.length;i++)(function(){var e=results[i],t="",r="",o=e.categories,a=e.location,f=a.coordinate.latitude,l=a.coordinate.longitude;for(x=0;x<o.length;x++)r+=(r!=""?", ":"")+o[x][0];t+=typeof a.address[0]!=u?a.address[0]:"",t+=typeof a.address[1]!=u?(t!=""?", ":"")+a.address[1]:"",t+=typeof a.city!=u?(t!=""?"<br /> ":"")+a.city:"",t+=typeof a.state_code!=u?(t!=""?", ":"")+a.state_code:"",t+=typeof a.postal_code!=u?(t!=""?" ":"")+a.postal_code:"";var c="http://maps.google.com/maps?daddr="+e.name+", "+t.replace(/<br \/>/g,", ")+(current_location!=""?"&saddr="+current_location:""),h=$('<article class="g" />'),p=$('<header class="h clear" />');p.append('<div class="img rs">'+(typeof e.image_url=="string"?'<img class="rs" src="'+e.image_url+'" />':"")+"</div>"),p.append("<h1>"+e.name+"</h1>");if(typeof e.distance!=u){var d=Math.round(e.distance*10/1609.344)/10,v="mile";d==0&&(d=Math.round(e.distance),v="meter"),p.append('<div class="distance rs">'+d+" "+v+(d!=1?"s":"")+"</div>")}p.append('<img class="rating rs" src="'+e.rating_img_url+'" />');var m=$('<div class="d r clear" />'),g=$('<div class="inner" />').appendTo(m);g.append('<h1 class="rt">'+e.name+"</h1>");var y=$('<div class="meta" />').appendTo(g);y.append('<div class="address"><h2>Address - <a href="'+c+'" target="_blank">Get Directions</a></h2><span>'+t+"</span></div>"),typeof e.display_phone!=u&&y.append('<div class="phone"><h2>Phone - <a class="phone" href="tel:+1'+e.phone+'" target="_self">Call</a></h2><span>'+e.display_phone+"</span></div>"),y.append('<div class="categories"><h2>Categories</h2><span>'+r+"</span></div>"),g.append('<div class="buttons rb"><a class="b r y" href="'+e.url+'" data-mobile="'+e.mobile_url+'" target="_blank">Read Reviews on Yelp</a></div>'),h.append(p,m),$("#r").append(h);if(mode==1){var b=new google.maps.LatLng(f,l);s.push(b),setTimeout(function(){var e=new google.maps.Marker({position:b,map:map,animation:google.maps.Animation.DROP});google.maps.event.addListener(e,"click",function(){showLocation({el:h,pos:b})}),p.click(function(e){e.preventDefault(),h.hasClass("active")?h.removeClass("active"):showLocation({el:h,pos:b})}),markers.push(e)},n),n+=Math.random()*100}else p.click(function(e){e.preventDefault(),h.hasClass("active")?h.removeClass("active"):(g.find(".mp").length==0&&g.prepend('<a class="mp" target="_blank" href="'+c+'"><img class="rs" src="http://maps.googleapis.com/maps/api/staticmap?center='+f+","+l+"&zoom=16&size=380x100&maptype=roadmap&markers="+f+","+l+'&sensor=false" /></a>'),showLocation({el:h}))})})();mode==1&&pages>1?$("#n").show():$("#n").hide(),$("#r .g").animate({opacity:1},t),$("#r").animate({height:($("#r .g").length<limit?$("#r .g").length:limit)*72},t,function(){mode==0&&($("#r").css("height","auto"),$("html,body").animate({scrollTop:$("#r .g:first").offset().top}))});if(mode==1&&typeof map!=u&&map!=null&&results.length>0){bounds=new google.maps.LatLngBounds;for(i in s)bounds.extend(s[i]);map.setZoom(14),map.fitBounds(bounds)}}else $("#r").remove()})}function centerMap(e,t){if(typeof t==u)var t=!0;var n=Math.pow(2,map.getZoom()),r=map.getProjection().fromLatLngToPoint(current),i=$("#c").offset().left+$("#c").outerWidth(),s=($(window).width()-i)/2,o=$(window).height()/6;r.x=(r.x*n-(s+i-$(window).width()/2))/n,r.y=(r.y*n-o)/n;var a=map.getProjection().fromPointToLatLng(r);map.panTo(a),typeof e!=u&&google.maps.event.addListenerOnce(map,"idle",function(){e(s+i)})}function showLocation(e){$(".g").not(e.el).removeClass("active"),e.el.addClass("active");if(mode==0)$("html,body").animate({scrollTop:e.el.offset().top-1});else{$("body > .d").animate({opacity:0},200,function(){$(this).remove()}),current=e.pos;var t=e.el.find(".d").clone();t.css({opacity:0}).appendTo("body"),typeof e.pan==u&&(e.pan=!0),centerMap(function(e){$("body > .d").css({left:e-$("body > .d").outerWidth()/2,bottom:"34%"}).animate({opacity:1,bottom:"38%"})},e.pan)}}function update(){mode=$(window).width()>=769?1:0,$("body > .d").animate({bottom:"34%",opacity:0},200,function(){$(this).remove()});if(mode==0)e=999,pages=1,$("#n").hide(),$("#m > img").length<1&&$("#m").html('<img src="http://maps.googleapis.com/maps/api/staticmap?center='+lat+","+lng+'&zoom=14&size=768x768&maptype=roadmap&sensor=false" />'),map=null;else{if(typeof map==u||map==null)center=new google.maps.LatLng(lat,lng),map=new google.maps.Map(document.getElementById("m"),{zoom:12,center:center,draggable:!1,mapTypeId:google.maps.MapTypeId.ROADMAP,scrollwheel:!1,mapTypeControl:!1,panControl:!1,zoomControl:!1,streetViewControl:!1});$(".g").length>0&&($(".g").removeClass("active"),map.fitBounds(bounds));var e=Math.floor(($(window).height()-parseInt($("#c").css("margin-top"))-parseInt($("#c").css("margin-bottom"))-$("#s").outerHeight()-$("#h").outerHeight()-$("#n").outerHeight()-$("#f").outerHeight()-16)/72);pages=Math.ceil(results.length/e)}e<=0&&(e=1),e!=limit&&(limit=e,$(".g").length>0&&showPage(pg,0))}var bounds,categories="restaurants,active,arcades,galleries,gardens,movietheaters,festivals,museums,theater,sportsteams,stadiumsarenas,education,campgrounds,tours,skiresorts,poolhalls,farmersmarket",center,current,current_location="",current_term='"Good+For+Kids"',current_sort=0,lat="33.195869",lng="-117.379483",limit=0,map,markers=[],mode=0,offset=0,pg=1,pages=1,results=[],u="undefined",updateTimer;$.browser.msie||$(".t").addClass("nie"),navigator.geolocation&&navigator.geolocation.getCurrentPosition(function(e){lat=e.coords.latitude,lng=e.coords.longitude,center=new google.maps.LatLng(lat,lng),typeof map!=u&&map!=null&&map.setCenter(center);var t=new google.maps.Geocoder;t.geocode({latLng:center},function(e,t){if(t==google.maps.GeocoderStatus.OK){var n="",r="",s=e[0].address_components,o={street_number:"",route:" ",locality:", ",administrative_area_level_1:", ",postal_code:" "},u={locality:"",administrative_area_level_1:", "};for(i in s)s[i].types[0]in o&&(r+=o[s[i].types[0]]+s[i].long_name),s[i].types[0]in u&&(n+=u[s[i].types[0]]+s[i].short_name);$("#l").attr("placeholder",n),current_location=r}});var n=[];yelp("search",{ll:lat+","+lng,term:current_term},function(e){if(e.businesses.length>0){results=e.businesses;var t="";$.each(results,function(e,r){var i=r.categories[r.categories.length-1][0];n.push(i),t.length+i.length<=30&&!(i in n)&&(t+=(t!=""?", ":"")+i)}),$("#t").attr("placeholder",t+", etc.")}})},function(e){},{timeout:1e4}),$("form").submit(function(e){e.preventDefault(),$(".s").focus();var t=$("#l").val(),n=$("#t").val()+($("#t").val()!=""?" ":"")+'"Good For Kids"',r=$("#sort").val();if(t!=current_location||n!=""&&n!=current_term||r!=current_sort){var i={term:n.replace(/ /g,"+"),sort:r};lat!=""&&lng!=""&&(i[t!=""?"cll":"ll"]=lat+","+lng),t!=""&&(i.location=t.replace(/ /g,"+")),current_location=t!=""?t:current_location,current_term=n!=""?n:current_term,current_sort=r,yelp("search",i,function(e){results=e.businesses,pages=Math.ceil(results.length/limit),showPage(1)})}}),$("a").not('[href^="tel"],[href^="#"],[href^="/"],[href*="'+window.location.host+'"]').attr("target","_blank"),$("a").live("click",function(e){mode==0&&$(this).attr("data-mobile")!=""?($(this).attr("data-desktop",$(this).attr("href")),$(this).attr("href",$(this).attr("data-mobile"))):$(this).attr("data-desktop")!=""&&$(this).attr("href",$(this).attr("data-desktop"))}),$(window).resize(update),update();